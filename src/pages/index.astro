---
import Layout from '../layouts/Layout.astro';
import EarthCanvas from '../components/EarthCanvas.tsx';
import LeetCodeCard from '../components/LeetCodeCard.tsx';
import ProjectGrid from '../components/ProjectGrid.tsx';
import LinkedInCard from '../components/LinkedInCard.tsx';
import CertificationGrid from '../components/CertificationGrid.tsx';
import Navbar from '../components/Navbar.astro';
import { Mail, Terminal, ExternalLink, Activity, Cpu, Database, Cloud, Code2 } from 'lucide-react';

export const prerender = false;
---

<Layout title="Abhiram | Portfolio">
  <div class="fixed inset-0 z-0 bg-[#000000] overflow-hidden">
    <div id="stars" class="absolute inset-0"></div>
    <div id="stars2" class="absolute inset-0"></div>
    <div id="stars3" class="absolute inset-0"></div>
    
    <div class="absolute inset-0 z-10 bg-[url('/noise.svg')] opacity-[0.04] mix-blend-overlay pointer-events-none"></div>
    <EarthCanvas client:only="react" />
    <div class="absolute inset-0 z-20 bg-gradient-to-b from-black/10 via-black/20 to-[#000000]"></div>
  </div>

  <Navbar />

  <main class="relative z-10 w-full">
    
    <section id="home" class="h-screen w-full flex items-center justify-end px-[5vw] py-20">
      <div class="text-right animate-fade-in w-full max-w-7xl">
        <h1 class="text-[clamp(4.5rem,15vw,12rem)] font-black tracking-tighter text-white leading-[0.8] uppercase italic">
          ABHI<br/>
          <span class="text-blue-500">ram</span>
        </h1>
        
        <div class="mt-8 border-t border-white/10 pt-8 inline-block">
          <p class="text-[clamp(1.5rem,4vw,2.5rem)] text-white font-bold tracking-tight uppercase">
            Purdue University
          </p>
          <p class="text-white/40 text-[clamp(0.8rem,1.5vw,1.2rem)] font-mono tracking-[0.2em] uppercase mt-2">
            M.S. Student in <span class="text-blue-400/80 italic">Computer Science</span>
          </p>
        </div>
      </div>
    </section>

    <section class="w-full py-10 px-[5vw] flex flex-wrap items-center justify-center gap-8 -mt-20 mb-20">
      <div class="flex items-center gap-4 px-6 py-3 rounded-full border border-white/5 bg-white/[0.02] backdrop-blur-md">
        <div class="h-2 w-2 rounded-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
        <p class="font-mono text-[10px] uppercase tracking-[0.2em] text-white/50">
          Visitors: <span id="visitor-count" class="text-blue-500 font-black ml-1 text-glow">000000</span>
        </p>
      </div>

      <div class="flex items-center gap-4 px-6 py-3 rounded-full border border-white/5 bg-white/[0.02] backdrop-blur-md">
        <Activity size={12} id="metrics-icon" class="text-white/20" />
        <p class="font-mono text-[10px] uppercase tracking-[0.2em] text-white/50">
          Uplink: <span id="uplink-status" class="ml-1 text-red-500 font-bold uppercase tracking-widest">OFFLINE</span>
        </p>
      </div>
    </section>

    <div class="w-full bg-white/[0.01] border-y border-white/5 py-6 backdrop-blur-sm overflow-hidden whitespace-nowrap mb-20 relative">
        <div class="absolute inset-y-0 left-0 w-32 bg-gradient-to-r from-black to-transparent z-10"></div>
        <div class="absolute inset-y-0 right-0 w-32 bg-gradient-to-l from-black to-transparent z-10"></div>
        
        <div class="inline-block animate-marquee">
            <div class="inline-flex items-center gap-16 px-8 font-mono text-[11px] uppercase tracking-[0.4em] text-white/40">
                <span class="flex items-center gap-2"><Code2 size={14} class="text-blue-500"/> React</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cpu size={14} class="text-blue-500"/> TypeScript</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cloud size={14} class="text-blue-500"/> AWS Cloud</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Database size={14} class="text-blue-500"/> DynamoDB</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Code2 size={14} class="text-blue-500"/> Astro</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cpu size={14} class="text-blue-500"/> Node.js</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Database size={14} class="text-blue-500"/> Python</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Code2 size={14} class="text-blue-500"/> React</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cpu size={14} class="text-blue-500"/> TypeScript</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cloud size={14} class="text-blue-500"/> AWS Cloud</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Database size={14} class="text-blue-500"/> DynamoDB</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Code2 size={14} class="text-blue-500"/> Astro</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cpu size={14} class="text-blue-500"/> Node.js</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Database size={14} class="text-blue-500"/> Python</span>
                <span class="text-white/10">//</span>
            </div>
        </div>
    </div>

    <section id="leetcode" class="min-h-screen w-full flex flex-col items-center justify-center px-[5vw] py-32">
      <div class="max-w-6xl w-full">
        <h2 class="text-blue-500 font-mono tracking-[0.6em] text-center text-[10px] uppercase mb-16">Problem Solving Stats</h2>
        <div class="backdrop-blur-xl rounded-[3rem] border border-white/5 bg-white/[0.01]">
           <LeetCodeCard client:load /> 
        </div>
      </div>
    </section>

    <section id="builds" class="min-h-screen w-full py-32 px-[5vw]">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-24 gap-12">
          <div class="max-w-xl text-left">
            <h3 class="font-mono text-blue-500 uppercase tracking-[0.6em] mb-6 text-[10px]">Project Portfolio</h3>
            <p class="text-white/30 text-xs font-mono uppercase tracking-tighter">Synthesizing cloud-native architectures.</p>
          </div>
          <h2 class="text-[clamp(3.5rem,10vw,7rem)] font-black italic uppercase tracking-tighter text-white leading-none">Key <span class="text-blue-500">Builds</span></h2>
        </div>
        <ProjectGrid client:load />
      </div>
    </section>

    <section id="network" class="min-h-screen w-full py-32 px-[5vw] flex items-center justify-center">
      <LinkedInCard client:load />
    </section>

    <section id="certifications" class="min-h-screen w-full py-32 px-[5vw] flex items-center justify-center">
      <div class="max-w-7xl w-full">
        <h2 class="text-blue-500 font-mono tracking-[0.6em] text-center text-[10px] uppercase mb-16">Verified Credentials</h2>
        <CertificationGrid client:load />
      </div>
    </section>

    <section id="contact" class="min-h-[80vh] w-full py-32 px-[5vw] flex items-center justify-center">
      <div class="max-w-4xl w-full text-center">
        <div class="group p-12 md:p-20 rounded-[3.5rem] border border-white/10 bg-black backdrop-blur-[60px] shadow-2xl transition-all hover:border-blue-500/30">
          <h2 class="text-5xl md:text-7xl font-black italic text-white uppercase tracking-tighter mb-8">Contact <span class="text-blue-500">Node</span></h2>
          <a href="mailto:mulpm01@purdue.edu" class="inline-flex flex-col items-center gap-4 px-10 py-8 rounded-[2rem] bg-white/5 border border-white/5 hover:border-blue-500/40 transition-all duration-500">
            <Mail size={40} class="text-blue-500" />
            <span class="text-xl md:text-3xl font-mono font-bold text-white tracking-widest break-all">mulpm01@purdue.edu</span>
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script>
  async function syncDashboard() {
    try {
      const res = await fetch('/api/telemetry');
      const data = await res.json();
      const statusEl = document.getElementById('uplink-status');
      const iconEl = document.getElementById('metrics-icon');

      if (data.aws?.status === "ONLINE") {
        if (statusEl) {
          statusEl.innerText = "ACTIVE";
          statusEl.className = "ml-1 text-blue-400 font-bold uppercase tracking-widest animate-pulse";
        }
        if (iconEl) iconEl.setAttribute('class', 'lucide lucide-activity text-blue-500 animate-pulse');
      }

      const alreadyHit = sessionStorage.getItem('v_hit');
      const vRes = await fetch(`/api/visitor-count${!alreadyHit ? '?hit=true' : ''}`);
      const vData = await vRes.json();
      if (!alreadyHit) sessionStorage.setItem('v_hit', 'true');

      const vEl = document.getElementById('visitor-count');
      if (vEl && vData.count) animateCount(vEl, parseInt(vData.count));
    } catch (e) { console.error('üõ∞Ô∏è Sync Failed'); }
  }

  function animateCount(element: HTMLElement, target: number) {
    let current = parseInt(element.innerText) || 0;
    const duration = 2000;
    const start = performance.now();
    function update(now: number) {
      const elapsed = now - start;
      const progress = Math.min(elapsed / duration, 1);
      const easeOut = 1 - Math.pow(1 - progress, 3);
      element.innerText = Math.floor(easeOut * target).toString().padStart(6, '0');
      if (progress < 1) requestAnimationFrame(update);
    }
    requestAnimationFrame(update);
  }

  window.addEventListener('load', () => {
    syncDashboard();
    setInterval(syncDashboard, 60000); 
  });
</script>

<style is:global>
  :global(html) {
    scroll-behavior: smooth;
    overflow-y: auto;
    scrollbar-width: none;
    background-color: #000000;
  }
  ::-webkit-scrollbar { display: none; }
  :global(body) { margin: 0; overflow-x: hidden; }

  /* --- STELLAR BACKGROUND GENERATOR --- */
  /* Generate random stars using box-shadow */
  #stars {
    width: 1px;
    height: 1px;
    background: transparent;
    box-shadow: 1452px 1451px #FFF , 246px 1452px #FFF, 1234px 12px #FFF, 456px 890px #FFF, 120px 450px #FFF, 1600px 300px #FFF, 800px 900px #FFF, 300px 1200px #FFF, 1400px 100px #FFF, 10px 800px #FFF;
    animation: animStar 50s linear infinite;
  }
  #stars2 {
    width: 2px;
    height: 2px;
    background: transparent;
    box-shadow: 123px 456px #FFF, 789px 123px #FFF, 456px 789px #FFF, 1000px 1000px #FFF, 1500px 200px #FFF, 200px 1500px #FFF;
    animation: animStar 100s linear infinite;
  }
  #stars3 {
    width: 3px;
    height: 3px;
    background: transparent;
    box-shadow: 500px 500px #FFF, 1200px 800px #FFF, 100px 1400px #FFF;
    animation: animStar 150s linear infinite;
  }

  @keyframes animStar {
    from { transform: translateY(0px); }
    to { transform: translateY(-2000px); }
  }

  .text-glow { text-shadow: 0 0 30px rgba(59, 130, 246, 0.4); }
  .animate-marquee { display: inline-block; animation: marquee 30s linear infinite; }
  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .animate-fade-in { animation: fadeIn 1.5s ease-out forwards; }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>