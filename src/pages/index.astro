---
import Layout from '../layouts/Layout.astro';
import EarthCanvas from '../components/EarthCanvas.tsx';
import LeetCodeCard from '../components/LeetCodeCard.tsx';
import ProjectGrid from '../components/ProjectGrid.tsx';
import LinkedInCard from '../components/LinkedInCard.tsx';
import CertificationGrid from '../components/CertificationGrid.tsx';
import Navbar from '../components/Navbar.astro';
import { Mail, Cpu, Database, Cloud, Code2, Banknote } from 'lucide-react';

export const prerender = false;
---

<Layout title="Abhiram | Portfolio">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&family=Inter:opsz,wght@14..32,100..900&display=swap" rel="stylesheet">

  <div class="fixed inset-0 z-0 bg-[#000000] overflow-hidden">
    <div id="stars" class="absolute inset-0"></div>
    <div id="stars2" class="absolute inset-0"></div>
    <div id="stars3" class="absolute inset-0"></div>
    
    <div class="absolute inset-0 z-10 bg-[url('/noise.svg')] opacity-[0.03] mix-blend-overlay pointer-events-none"></div>
    <EarthCanvas client:only="react" />
    <div class="absolute inset-0 z-20 bg-gradient-to-b from-black/20 via-black/40 to-[#000000]"></div>
  </div>

  <Navbar />

  <div 
    id="draggable-island" 
    class="fixed bottom-8 right-8 z-50 cursor-move select-none touch-none group"
  >
    <a href="/hosts" id="island-link" class="block" ondragstart="return false;">
      <div class="flex items-center gap-4 px-5 py-4 rounded-[2rem] border border-white/5 bg-white/[0.02] backdrop-blur-2xl hover:border-blue-500/30 transition-all duration-500 shadow-2xl active:scale-95 pointer-events-auto">
        <div class="flex h-10 w-10 items-center justify-center rounded-2xl bg-blue-500/10 text-blue-500 group-hover:bg-blue-500 group-hover:text-white transition-colors pointer-events-none">
          <Banknote size={20} />
        </div>
        <div class="flex flex-col pr-2 pointer-events-none">
          <span class="text-[9px] font-bold uppercase tracking-[0.2em] text-white/30 mb-0.5">Infra Cost</span>
          <div class="flex items-baseline gap-1">
            <span class="text-xs font-bold text-white/40">$</span>
            <span id="aws-cost" class="text-lg font-mono font-bold text-white tracking-tighter">0.00</span>
          </div>
        </div>
      </div>
    </a>
  </div>

  <main class="relative z-10 w-full antialiased font-inter">
    
    <section id="home" class="h-screen w-full flex items-center justify-end px-[8vw] py-20">
      <div class="text-right w-full max-w-7xl">
        <h1 class="hero-name text-[clamp(3.5rem,10vw,8.5rem)] leading-none select-none opacity-0 animate-name-slide-up">
          Abhiram
        </h1>
        <p class="hero-tagline text-[clamp(1.2rem,3vw,2.2rem)] text-white/80 mt-2 pr-1 opacity-0 animate-tagline-slide-down">
          Architecting the Digital Cosmos
        </p>
        <div class="mt-12 border-t border-white/10 pt-10 inline-block opacity-0 animate-details-fade">
          <p class="text-[clamp(1rem,2.2vw,1.4rem)] text-white font-semibold tracking-tight leading-none uppercase">
            Purdue University
          </p>
          <p class="text-blue-400/60 text-[clamp(0.7rem,0.9vw,0.8rem)] font-bold uppercase tracking-[0.5em] mt-5">
            M.S. Student in <span class="text-white/80">Computer Science</span>
          </p>
        </div>
      </div>
    </section>

    <section class="w-full py-10 px-[5vw] flex items-center justify-center -mt-20 mb-20">
      <div class="flex items-center gap-3 px-6 py-3 rounded-full border border-white/5 bg-white/[0.02] backdrop-blur-2xl hover:border-blue-500/30 transition-colors duration-500">
        <div class="h-1.5 w-1.5 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.6)] animate-pulse"></div>
        <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-white/40">
          Global Visitors: <span id="visitor-count" class="text-blue-500 font-extrabold ml-1">000000</span>
        </p>
      </div>
    </section>

    <div class="w-full bg-white/[0.01] border-y border-white/5 py-8 backdrop-blur-sm overflow-hidden whitespace-nowrap mb-20 relative">
        <div class="absolute inset-y-0 left-0 w-32 bg-gradient-to-r from-black to-transparent z-10"></div>
        <div class="absolute inset-y-0 right-0 w-32 bg-gradient-l from-black to-transparent z-10"></div>
        <div class="inline-block animate-marquee">
            <div class="inline-flex items-center gap-16 px-8 text-[11px] font-bold uppercase tracking-[0.3em] text-white/30">
                <span class="flex items-center gap-2"><Code2 size={13} class="text-blue-500"/> React</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cpu size={13} class="text-blue-500"/> TypeScript</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cloud size={13} class="text-blue-500"/> AWS Cloud</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Database size={13} class="text-blue-500"/> DynamoDB</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Code2 size={13} class="text-blue-500"/> Astro</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Cpu size={13} class="text-blue-500"/> Node.js</span>
                <span class="text-white/10">//</span>
                <span class="flex items-center gap-2"><Database size={13} class="text-blue-500"/> Python</span>
            </div>
        </div>
    </div>

    <section id="leetcode" class="min-h-screen w-full flex flex-col items-center justify-center px-[5vw] py-32">
      <div class="max-w-5xl w-full">
        <h2 class="section-title">Statistical Performance</h2>
        <a href="/leetcode" class="block group relative cursor-pointer">
            <div class="backdrop-blur-3xl rounded-[2.5rem] border border-white/5 bg-white/[0.01] p-2 transition-all duration-500 group-hover:border-blue-500/30 group-hover:bg-white/[0.02]">
                <div class="absolute top-6 right-10 z-20 text-blue-500/40 group-hover:text-blue-500 transition-colors pointer-events-none">
                    <span class="text-[9px] font-bold uppercase tracking-widest flex items-center gap-2">Intelligence Dashboard <Code2 size={12}/></span>
                </div>
                <LeetCodeCard client:only="react" /> 
            </div>
        </a>
      </div>
    </section>

    <section id="builds" class="min-h-screen w-full py-32 px-[5vw]">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-24 gap-12">
          <div class="max-w-xl text-left">
            <h3 class="section-subtitle">System Architecture</h3>
            <p class="text-white/20 text-[10px] font-bold uppercase tracking-[0.2em]">Deployment Pipeline Verified.</p>
          </div>
          <h2 class="text-[clamp(3rem,8vw,6rem)] font-extrabold uppercase tracking-tight text-white leading-none">Core <span class="text-blue-500">Builds</span></h2>
        </div>
        <ProjectGrid client:load />
      </div>
    </section>

    <section id="certifications" class="min-h-screen w-full py-32 px-[5vw] flex items-center justify-center">
      <div class="max-w-7xl w-full">
        <h2 class="section-title">Verified Infrastructure</h2>
        <CertificationGrid client:load />
      </div>
    </section>

    <section id="contact" class="min-h-[80vh] w-full py-32 px-[5vw] flex items-center justify-center">
      <div class="max-w-3xl w-full text-center">
        <div class="group p-16 md:p-24 rounded-[3rem] border border-white/5 bg-white/[0.01] backdrop-blur-3xl transition-all">
          <h2 class="text-[clamp(2rem,5vw,4rem)] font-extrabold text-white uppercase tracking-tight mb-12 leading-none">Contact <span class="text-blue-500">Me</span></h2>
          <a href="mailto:mulpm01@purdue.edu" class="inline-flex flex-col items-center gap-6 px-12 py-10 rounded-[2rem] bg-white/5 border border-white/5 hover:border-blue-500/20 transition-all duration-500">
            <Mail size={28} class="text-blue-500" />
            <span class="text-[clamp(0.9rem,2.5vw,1.4rem)] font-bold text-white tracking-widest break-all">mulpm01@purdue.edu</span>
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script>
  async function syncDashboardData() {
    try {
      const vEl = document.getElementById('visitor-count');
      const vRes = await fetch('/api/visitor-count');
      const vData = await vRes.json();
      if (vEl && vData.count) vEl.innerText = vData.count.toString().padStart(6, '0');

      const cEl = document.getElementById('aws-cost');
      const dRes = await fetch('/api/telemetry'); 
      const dData = await dRes.json();
      if (cEl && dData.cost) {
        cEl.innerText = dData.cost.replace('-', '');
      }
    } catch (e) { 
      console.error('ðŸ›°ï¸ Sync Failed');
    }
  }

  function initDraggable() {
    const el = document.getElementById('draggable-island');
    const link = document.getElementById('island-link');
    if (!el || !link) return;

    let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    let startX = 0, startY = 0;
    let isDragging = false;
    const threshold = 10;

    el.addEventListener('mousedown', start);
    el.addEventListener('touchstart', start, { passive: false });

    function start(e) {
      const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
      const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
      pos3 = clientX; pos4 = clientY;
      startX = clientX; startY = clientY;
      isDragging = false;
      document.addEventListener('mousemove', move);
      document.addEventListener('touchmove', move, { passive: false });
      document.addEventListener('mouseup', end);
      document.addEventListener('touchend', end);
    }

    function move(e) {
      const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
      const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
      const dist = Math.sqrt(Math.pow(clientX - startX, 2) + Math.pow(clientY - startY, 2));
      
      if (dist > threshold) {
        isDragging = true;
        if (e.type === 'touchmove') e.preventDefault();
        pos1 = pos3 - clientX; pos2 = pos4 - clientY;
        pos3 = clientX; pos4 = clientY;
        el.style.top = (el.offsetTop - pos2) + "px";
        el.style.left = (el.offsetLeft - pos1) + "px";
        el.style.bottom = "auto";
        el.style.right = "auto";
      }
    }

    function end() {
      document.removeEventListener('mousemove', move);
      document.removeEventListener('touchmove', move);
      document.removeEventListener('mouseup', end);
      document.removeEventListener('touchend', end);
      if (isDragging) {
        const captureClick = (e) => {
          e.preventDefault(); e.stopImmediatePropagation();
          link.removeEventListener('click', captureClick, true);
        };
        link.addEventListener('click', captureClick, true);
      }
    }
  }

  window.addEventListener('load', () => {
    syncDashboardData();
    initDraggable();
  });
</script>

<style is:global>
  @reference "../styles/global.css"; 

  :global(html) {
    scroll-behavior: smooth;
    background-color: #000000;
    font-family: 'Inter', sans-serif;
    -webkit-font-smoothing: antialiased;
  }

  ::-webkit-scrollbar { display: none; }

  .hero-name {
    font-family: "Edu NSW ACT Cursive", cursive;
    font-optical-sizing: auto;
    font-weight: 700;
    font-style: normal;
    background: linear-gradient(to bottom, #ffffff 60%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    filter: drop-shadow(0 10px 30px rgba(59, 130, 246, 0.15));
  }

  .hero-tagline {
    font-family: "Edu NSW ACT Cursive", cursive;
    font-optical-sizing: auto;
    font-weight: 500;
    font-style: normal;
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
  }

  .animate-name-slide-up { animation: nameSlideUp 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
  .animate-tagline-slide-down { animation: taglineSlideDown 1.2s cubic-bezier(0.22, 1, 0.36, 1) 0.3s forwards; }
  .animate-details-fade { animation: detailsFade 1.5s ease-out 0.8s forwards; }
  
  @keyframes nameSlideUp {
    0% { transform: translateY(40px); opacity: 0; filter: blur(10px); }
    100% { transform: translateY(0); opacity: 1; filter: blur(0); }
  }
  @keyframes taglineSlideDown {
    0% { transform: translateY(-40px); opacity: 0; }
    100% { transform: translateY(0); opacity: 0.8; }
  }
  @keyframes detailsFade { 0% { opacity: 0; } 100% { opacity: 1; } }

  .section-title { @apply text-white/30 font-bold tracking-[0.6em] text-center text-[9px] uppercase mb-20; }
  .section-subtitle { @apply font-bold text-blue-500 uppercase tracking-[0.4em] mb-4 text-[9px]; }

  #stars, #stars2, #stars3 { position: absolute; inset: 0; background: transparent; }
  #stars { width: 1px; height: 1px; box-shadow: 1452px 1451px #FFF, 246px 1452px #FFF, 1234px 12px #FFF, 456px 890px #FFF; animation: animStar 50s linear infinite; }
  #stars2 { width: 2px; height: 2px; box-shadow: 123px 456px #FFF, 789px 123px #FFF; animation: animStar 100s linear infinite; }
  #stars3 { width: 3px; height: 3px; box-shadow: 500px 500px #FFF, 1200px 800px #FFF; animation: animStar 150s linear infinite; }

  @keyframes animStar { from { transform: translateY(0px); } to { transform: translateY(-2000px); } }
  .animate-marquee { display: inline-block; animation: marquee 40s linear infinite; }
  @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
</style>