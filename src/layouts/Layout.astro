---
// src/layouts/Layout.astro
import '../styles/global.css';
import Navbar from '../components/Navbar.astro';

interface Props { title: string; }
const { title } = Astro.props;

// 1. DYNAMIC INTENT LOGIC
const pathname = new URL(Astro.request.url).pathname;

const intentData = {
  '/': "INTENT: Professional synthesis of M.S. Computer Science projects  at Purdue University.",
  '/trends': "INTENT: Real-time analysis of technology and business signals synchronized via The Guardian Intelligence API & Alpha Vantage API.",
  '/infrastructure': "INTENT: Comprehensive fiscal audit of Year-to-Date (YTD) website maintenance costs and cloud health.",
  '/photography': "INTENT: Visual archive documenting optic interests and architectural captures through high-fidelity photography."
};

const intentMessage = intentData[pathname] || intentData['/'];
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title}</title>
  </head>
  <body class="bg-black text-white antialiased overflow-hidden">
    <div 
      id="global-alert" 
      class="fixed inset-0 z-[1000] flex items-center justify-center bg-black/80 backdrop-blur-md opacity-0 pointer-events-none transition-opacity duration-500"
    >
      <div class="w-[90%] max-w-md bg-[#050810] border border-blue-500/20 p-8 rounded-[2.5rem] shadow-[0_0_50px_rgba(59,130,246,0.3)] relative">
        <div class="flex items-center gap-3 mb-6">
          <div class="h-2 w-2 rounded-full bg-blue-500 animate-pulse"></div>
          <span class="font-mono text-[9px] uppercase tracking-[0.5em] text-blue-500 font-black">
            Intent_Disclosure_Protocol
          </span>
        </div>
        
        <p class="text-white font-mono text-[11px] leading-relaxed uppercase tracking-wide mb-10 border-l-2 border-blue-500/30 pl-4">
          {intentMessage}
        </p>

        <button 
          id="close-alert"
          class="w-full py-4 bg-blue-600/10 border border-blue-500/40 hover:bg-blue-600 hover:text-white text-blue-400 font-mono text-[10px] uppercase tracking-[0.3em] font-black rounded-2xl transition-all cursor-pointer"
        >
          Acknowledge & Sync
        </button>
      </div>
    </div>

    <Navbar /> 
    <slot />

    <script is:inline>
      function showIntentAlert() {
        const alertBox = document.getElementById('global-alert');
        const closeBtn = document.getElementById('close-alert');

        if (alertBox) {
          // Force a slight delay to ensure browser paints the background first
          setTimeout(() => {
            alertBox.classList.remove('pointer-events-none');
            alertBox.classList.add('opacity-100');
          }, 300);
        }

        if (closeBtn && alertBox) {
          closeBtn.onclick = () => {
            alertBox.classList.remove('opacity-100');
            alertBox.classList.add('opacity-0');
            alertBox.classList.add('pointer-events-none');
            
            // Allow page scrolling after alert is dismissed if needed
            document.body.classList.remove('overflow-hidden');
            document.body.classList.add('overflow-y-auto');
          };
        }
      }

      // Initialize on load
      showIntentAlert();
    </script>
  </body>
</html>